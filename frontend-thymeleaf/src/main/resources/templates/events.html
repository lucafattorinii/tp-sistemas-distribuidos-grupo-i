<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eventos - Empuje Comunitario</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: #0b1020; color: #e6e9ef; margin:0; }
    header { padding: 16px 24px; border-bottom: 1px solid #223058; }
    header h1 { margin: 0; font-size: 18px; color:#d6dcff; }
    .wrap { padding: 24px; max-width: 1000px; margin: 0 auto; }
    .card { background:#11162a; border:1px solid #253055; border-radius:14px; padding:20px; margin-bottom:20px; }
    h2 { margin: 0 0 12px; font-size: 16px; color:#d6dcff; }
    label { display:block; font-size:13px; margin:10px 0 6px; color:#ced5f3; }
    input, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2b3560; background:#0c1328; color:#f2f5ff; outline:none; }
    input:focus, textarea:focus { border-color:#4f66ff; box-shadow:0 0 0 3px rgba(79,102,255,.15); }
    .row { display:grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    button { padding:10px 14px; border:0; border-radius:10px; background:#4f66ff; color:#fff; font-weight:600; cursor:pointer; }
    table { width:100%; border-collapse: collapse; }
    th, td { text-align:left; padding:10px; border-bottom:1px solid #223058; font-size:14px; }
    th { color:#aab3d3; font-weight:600; }
    .toolbar { display:flex; justify-content: space-between; align-items:center; margin-bottom:10px; }
    .muted { color:#9fb0e5; font-size:12px; margin-top:8px; }
    .danger { background:#d9534f; }
    .secondary { background:#2d3a6b; }
  </style>
</head>
<body>
<header>
  <h1>Eventos</h1>
</header>
<div class="wrap">
  <div class="card">
    <h2>Nuevo evento</h2>
    <div class="row">
      <div>
        <label>Nombre</label>
        <input id="e_name" placeholder="Nombre del evento">
      </div>
      <div>
        <label>Fecha y hora (ISO)</label>
        <input id="e_dt" placeholder="2025-12-01T15:00:00">
      </div>
      <div style="grid-column: span 2">
        <label>Descripción</label>
        <textarea id="e_desc" rows="3" placeholder="Descripción..."></textarea>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:10px;">
      <button onclick="createEvent()">Crear</button>
      <span id="create_msg" class="muted"></span>
    </div>
  </div>

  <div class="card">
    <div class="toolbar">
      <h2>Listado</h2>
      <button class="secondary" onclick="loadEvents()">Refrescar</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="evt_tbody"></tbody>
    </table>
    <div id="list_msg" class="muted"></div>
  </div>
</div>
<script>
  const API_BASE = '';
  function authHeader(){
    const jwt = localStorage.getItem('jwt');
    return jwt ? { 'Authorization': 'Bearer ' + jwt } : {};
  }
  async function createEvent(){
    const body = {
      name: document.getElementById('e_name').value,
      description: document.getElementById('e_desc').value,
      event_datetime: document.getElementById('e_dt').value
    };
    const msg = document.getElementById('create_msg');
    msg.textContent = 'Creando...';
    try{
      const res = await fetch(API_BASE + '/api/events', {
        method:'POST', headers: { 'Content-Type':'application/json', ...authHeader() }, body: JSON.stringify(body)
      });
      const data = await res.json();
      if(!res.ok) throw new Error(data.detail || 'Error al crear');
      msg.textContent = 'Creado ID ' + data.id;
      loadEvents();
    }catch(err){ msg.textContent = err.message; }
  }
  async function loadEvents(){
    const tbody = document.getElementById('evt_tbody');
    const msg = document.getElementById('list_msg');
    msg.textContent = 'Cargando...';
    tbody.innerHTML = '';
    try{
      const res = await fetch(API_BASE + '/api/events', { headers: { ...authHeader() } });
      const data = await res.json();
      if(!res.ok) throw new Error(data.detail || 'Error al listar');
      (data.events || []).forEach(ev => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${ev.id}</td><td>${ev.name}</td>
          <td>
            <button class="secondary" onclick="assign(${ev.id})">Asignar (demo)</button>
            <button class="danger" onclick="del(${ev.id})">Borrar</button>
          </td>`;
        tbody.appendChild(tr);
      });
      msg.textContent='';
    }catch(err){ msg.textContent = err.message; }
  }
  async function del(id){
    const ok = confirm('¿Borrar evento ' + id + '?');
    if(!ok) return;
    await fetch(API_BASE + '/api/events/' + id, { method:'DELETE', headers: { ...authHeader() } });
    loadEvents();
  }
  async function assign(id){
    const uid = prompt('User ID a asignar:');
    if(!uid) return;
    await fetch(API_BASE + '/api/events/' + id + '/assign', {
      method:'POST', headers: { 'Content-Type':'application/json', ...authHeader() }, body: JSON.stringify({ user_id: parseInt(uid,10) })
    });
    alert('Asignado');
  }
  loadEvents();
</script>
</body>
</html>
